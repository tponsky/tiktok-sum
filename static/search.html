<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video RAG Search</title>
    <link rel="stylesheet" href="/static/style.css?v=50">
</head>

<body>
    <!-- User Header -->
    <div id="userHeader" class="user-header hidden">
        <div class="user-info">
            <span id="userEmail"></span>
            <span id="userBalance" class="balance-badge">$0.00</span>
            <span id="balanceHint" class="balance-hint"></span>
        </div>
        <div class="user-actions">
            <button id="addFundsBtn" class="add-funds-btn hidden">Add Funds</button>
            <button id="logoutBtn" class="logout-btn">Logout</button>
        </div>
    </div>

    <div class="container">
        <h1>Video Search</h1>

        <div class="tabs">
            <button class="tab-btn active" data-tab="search">Search</button>
            <button class="tab-btn" data-tab="ingest">Add Source</button>
            <button class="tab-btn" data-tab="bulk">Bulk Upload</button>
            <button class="tab-btn" data-tab="library">Library</button>
            <button class="tab-btn shortcut-tab-btn" data-tab="shortcut">
                <span class="apple-icon"></span> Get iOS Shortcut
            </button>
        </div>

        <div id="search-tab" class="tab-content active">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Ask a question about your videos...">
                <button id="searchBtn">Search</button>
            </div>

            <div class="search-options">
                <label class="web-search-toggle">
                    <input type="checkbox" id="includeWeb">
                    Also search the web
                </label>
            </div>

            <div class="filters">
                <details>
                    <summary>Advanced Filters</summary>
                    <div class="filter-controls">
                        <label>
                            Min Relevance: <span id="minScoreValue">30%</span>
                            <input type="range" id="minScore" min="0" max="100" value="30" step="1">
                        </label>
                        <label>
                            Author Filter:
                            <input type="text" id="authorFilter" placeholder="Filter by author...">
                        </label>
                    </div>
                </details>
            </div>

            <div id="loading" class="hidden">Thinking...</div>
            <div id="results">
                <div id="answer" class="answer-box hidden"></div>
                <div id="matches" class="matches-list"></div>
            </div>
        </div>

        <div id="ingest-tab" class="tab-content hidden">
            <div class="ingest-box">
                <h3>Add New Video</h3>
                <input type="text" id="ingestInput"
                    placeholder="Paste video URL (TikTok, YouTube, Instagram, Twitter...)">
                <input type="text" id="ingestTopic" placeholder="Topic/Category (optional)">
                <button id="ingestBtn">Add Video</button>
                <div id="ingestStatus" class="hidden"></div>
            </div>
        </div>

        <div id="bulk-tab" class="tab-content hidden">
            <div class="ingest-box">
                <h3>Bulk Upload Videos</h3>
                <p class="help-text">Paste multiple video URLs, one per line (max 50). Supports TikTok, YouTube,
                    Instagram, Twitter/X, Facebook, Vimeo, Reddit</p>
                <textarea id="bulkInput" placeholder="https://www.tiktok.com/@user/video/123
https://www.youtube.com/watch?v=abc123
https://www.instagram.com/reel/xyz"></textarea>
                <input type="text" id="bulkTopic" placeholder="Topic/Category for all videos (optional)">
                <div class="bulk-actions">
                    <span id="urlCount">0 URLs detected</span>
                    <button id="bulkBtn">Upload All</button>
                </div>
                <div id="bulkStatus" class="hidden"></div>
            </div>
        </div>

        <div id="library-tab" class="tab-content hidden">
            <div class="library-header">
                <h3>Video Library</h3>
                <div class="library-filters">
                    <select id="librarySortBy">
                        <option value="category">By Category</option>
                        <option value="date">By Date Added</option>
                    </select>
                    <select id="topicFilter">
                        <option value="">All Topics</option>
                    </select>
                    <select id="authorFilterLibrary">
                        <option value="">All Creators</option>
                    </select>
                    <button id="refreshLibrary">Refresh</button>
                    <button id="manageCategoriesBtn" class="secondary-btn">Manage Categories</button>
                </div>
            </div>
            <!-- Category Quick Jump Navigation -->
            <div id="categoryNav" class="category-nav"></div>
            <div id="libraryLoading" class="hidden">Loading library...</div>
            <div id="libraryContent">
                <div id="libraryStats" class="library-stats"></div>
                <div id="libraryVideos" class="library-grid"></div>
            </div>
        </div>

        <!-- Shortcut/API Key Tab -->
        <div id="shortcut-tab" class="tab-content hidden">
            <!-- Intro Banner -->
            <div class="shortcut-intro-banner">
                <div class="shortcut-intro-icon">üì±</div>
                <div class="shortcut-intro-text">
                    <h2>Save Videos with One Tap</h2>
                    <p>Add videos from TikTok, Instagram, or YouTube directly to your library using iOS Shortcuts.</p>
                </div>
            </div>

            <!-- Steps Required Notice -->
            <div class="steps-required-notice">
                <div class="notice-icon">‚ö†Ô∏è</div>
                <div class="notice-text">
                    <strong>Complete all 3 steps below to set up the shortcut.</strong>
                    <span>The shortcut won't work without your API key!</span>
                </div>
            </div>

            <div class="shortcut-instructions">
                <!-- Step 1: Generate API Key -->
                <div class="instruction-card step-card" id="step1-card">
                    <div class="instruction-header">
                        <span class="instruction-number">1</span>
                        <h3>Generate Your API Key</h3>
                        <span class="step-status" id="step1-status">Required</span>
                    </div>
                    <p>This key connects the shortcut to your account:</p>
                    <div class="api-key-box">
                        <div class="api-key-display">
                            <input type="text" id="apiKeyDisplay" readonly
                                placeholder="Click 'Generate' to create your key">
                            <button id="copyApiKey" class="copy-btn" disabled>Copy</button>
                        </div>
                        <div class="api-key-actions">
                            <button id="generateApiKey" class="primary-btn">Generate Key</button>
                            <button id="revokeApiKey" class="text-btn" disabled>Revoke</button>
                        </div>
                        <p id="apiKeyStatus" class="api-key-status"></p>
                    </div>
                </div>

                <!-- Step 2: Download Shortcut -->
                <div class="instruction-card step-card" id="step2-card">
                    <div class="instruction-header">
                        <span class="instruction-number">2</span>
                        <h3>Download the Shortcut</h3>
                    </div>
                    <p>Get the iOS Shortcut on your iPhone:</p>
                    <div class="download-section">
                        <a href="https://www.icloud.com/shortcuts/fd9bd71da15a4da79518ae554f9f068f"
                            class="download-shortcut-btn-inline" target="_blank">
                            <span class="apple-icon"></span> Download Shortcut
                        </a>
                        <p class="download-hint">Opens in Safari ‚Üí Tap "Get Shortcut" ‚Üí "Add Shortcut"</p>
                    </div>
                </div>

                <!-- Step 3: Configure the Shortcut -->
                <div class="instruction-card step-card" id="step3-card">
                    <div class="instruction-header">
                        <span class="instruction-number">3</span>
                        <h3>Add Your API Key to the Shortcut</h3>
                    </div>
                    <div class="instruction-steps">
                        <div class="instruction-step">
                            <p><strong>a.</strong> Open the <strong>Shortcuts</strong> app on your iPhone</p>
                            <div class="screenshot-placeholder screenshot-small" data-img="shortcuts-app.png">
                                <img src="/static/screenshots/shortcuts-app.png" alt="Open Shortcuts app"
                                    onerror="this.parentElement.classList.add('no-image')">
                            </div>
                        </div>
                        <div class="instruction-step">
                            <p><strong>b.</strong> Find <strong>"Video Library"</strong> and tap the <strong>‚ãØ</strong>
                                button to edit</p>
                            <div class="screenshot-placeholder" data-img="edit-shortcut.png">
                                <img src="/static/screenshots/edit-shortcut.png" alt="Edit the shortcut"
                                    onerror="this.parentElement.classList.add('no-image')">
                            </div>
                        </div>
                        <div class="instruction-step">
                            <p><strong>c.</strong> Find the <code>api_key</code> field and replace
                                <code>PASTE_YOUR_API_KEY_HERE</code> with your key</p>
                            <div class="screenshot-placeholder" data-img="paste-key.png">
                                <img src="/static/screenshots/paste-key.png" alt="Paste your API key"
                                    onerror="this.parentElement.classList.add('no-image')">
                            </div>
                        </div>
                        <div class="instruction-step">
                            <p><strong>d.</strong> Tap <strong>Done</strong> to save</p>
                        </div>
                    </div>
                </div>

                <!-- Success / How to Use -->
                <div class="instruction-card success-card">
                    <div class="instruction-header">
                        <span class="instruction-number success-number">‚úì</span>
                        <h3>You're All Set!</h3>
                    </div>
                    <div class="instruction-steps">
                        <div class="instruction-step">
                            <p>When watching any video on TikTok, Instagram, or YouTube:</p>
                            <ol class="use-steps">
                                <li>Tap the <strong>Share</strong> button</li>
                                <li>Scroll the bottom row and tap <strong>"Video Library"</strong></li>
                                <li>The video will be transcribed and added to your library!</li>
                            </ol>
                            <div class="screenshot-placeholder" data-img="share-menu.png">
                                <img src="/static/screenshots/share-menu.png" alt="Share menu example"
                                    onerror="this.parentElement.classList.add('no-image')">
                            </div>
                        </div>
                    </div>
                </div>

                <details class="advanced-section">
                    <summary>Advanced: Manual Setup / API Reference</summary>
                    <div class="advanced-content">
                        <p>If you prefer to create the shortcut manually:</p>
                        <ol>
                            <li>Create a new shortcut</li>
                            <li>Add <strong>"Receive Apps and 18 more from Share Sheet"</strong> as the input</li>
                            <li>Set "If there's no input" to <strong>Continue</strong></li>
                            <li>Add <strong>"Get Contents of URL"</strong> action</li>
                            <li>Set URL to: <code>https://tiktoksum.staycurrentapp.com/api/shortcut/ingest</code></li>
                            <li>Set Method to: <strong>POST</strong></li>
                            <li>Set Request Body to: <strong>JSON</strong></li>
                            <li>Add field <code>url</code> ‚Üí <strong>Shortcut Input</strong></li>
                            <li>Add field <code>api_key</code> ‚Üí your API key</li>
                            <li>Add <strong>"Show Notification"</strong> action with message "Video Saved!"</li>
                        </ol>
                        <p class="endpoint-body">JSON body format:</p>
                        <pre class="endpoint-example">{
  "url": "https://www.tiktok.com/...",
  "api_key": "your_api_key_here",
  "topic": "optional category"
}</pre>
                    </div>
                </details>
            </div>
        </div>

        <!-- Category Management Modal -->
        <div id="categoryModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Manage Categories</h3>
                    <button class="close-btn" id="closeCategoryModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="add-category-form">
                        <input type="text" id="newCategoryInput" placeholder="New category name...">
                        <button id="addCategoryBtn">Add</button>
                    </div>
                    <div id="categoryList" class="category-list"></div>
                </div>
            </div>
        </div>

        <!-- Video Category Edit Modal -->
        <div id="videoCategoryModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Edit Video Categories</h3>
                    <button class="close-btn" id="closeVideoCategoryModal">&times;</button>
                </div>
                <div class="modal-body">
                    <p id="editVideoTitle" class="edit-video-title"></p>
                    <div id="videoCategoryCheckboxes" class="category-checkboxes"></div>
                    <div class="add-category-inline">
                        <input type="text" id="newCategoryInline" placeholder="Add new category...">
                        <button id="addCategoryInlineBtn" type="button">Add</button>
                    </div>
                    <button id="saveVideoCategoriesBtn" class="save-btn">Save Categories</button>
                </div>
            </div>
        </div>

        <!-- Video Edit Modal -->
        <div id="videoEditModal" class="modal hidden">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h3>Edit Video Details</h3>
                    <button class="close-btn" id="closeVideoEditModal" type="button">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="edit-form">
                        <div class="edit-field">
                            <label class="edit-label" for="editTitleInput">Title</label>
                            <input type="text" id="editTitleInput" class="edit-input">
                        </div>
                        <div class="edit-field">
                            <label class="edit-label" for="editKeyTakeawayInput">Key Takeaway</label>
                            <input type="text" id="editKeyTakeawayInput" class="edit-input"
                                placeholder="The main insight or tip...">
                        </div>
                        <div class="edit-field">
                            <label class="edit-label" for="editSummaryInput">Summary</label>
                            <textarea id="editSummaryInput" class="edit-textarea" rows="6"></textarea>
                        </div>
                    </div>
                    <button id="saveVideoEditBtn" class="save-btn" type="button">Save Changes</button>
                </div>
            </div>
        </div>
    </div>
    <script src="/static/script.js?v=28"></script>
</body>

</html>