# VidRecall Deployment Notes - December 23, 2025

## Server Information
- **URL**: https://tiktoksum.staycurrentapp.com
- **Server**: GoDaddy VPS (72.167.132.33)
- **User**: ponsky
- **App Directory**: `/home/ponsky/tiktok-sum`
- **Container**: `tiktok-rag` (Docker)
- **Port**: 8080

## Environment Variables (in .env)
```
OPENAI_API_KEY=sk-proj-...
PINECONE_API_KEY=pcsk_...
JWT_SECRET_KEY=<your-jwt-secret>
STRIPE_SECRET_KEY=sk_live_...
STRIPE_WEBHOOK_SECRET=whsec_...
APP_URL=https://tiktoksum.staycurrentapp.com
RESEND_API_KEY=<your-resend-key>
```

## Admin Access
- **Admin Panel**: https://tiktoksum.staycurrentapp.com/static/admin.html
- **Admin Email**: tponsky@gmail.com
- **Features**: Credit users, view all users, webhook status

## Stripe Configuration
- **Webhook Endpoint**: https://tiktoksum.staycurrentapp.com/api/stripe/webhook
- **Events**: checkout.session.completed
- **Webhook Secret**: whsec_JAznV82y80LicgtHrpEnf6moP0jN5jII

## Credit System
- **Ingest Cost**: $0.03 per video
- **Search Cost**: $0.005 per search
- **Initial Credit**: $2.00 for new users
- **Reload Amount**: $10.00

## Deployment Commands
```bash
# SSH to server
sshpass -p 'PhE@C1%5MAuv' ssh ponsky@72.167.132.33

# Deploy (from /home/ponsky/tiktok-sum)
./deploy.sh

# View logs
docker logs -f tiktok-rag

# Monitor webhooks
docker logs -f tiktok-rag | grep WEBHOOK

# Restart container
docker restart tiktok-rag
```

---

## Changelog

### December 23, 2025 - Stripe Webhook Fix
- **Issue**: Stripe payments succeeded but balance not updated
- **Root Cause**: Wrong STRIPE_WEBHOOK_SECRET (was using ragagent's secret instead of tiktoksum's)
- **Fix**: 
  - Updated STRIPE_WEBHOOK_SECRET to correct value
  - Added extensive webhook logging for debugging
  - Added email fallback lookup if user_id missing from metadata
  - Added admin panel for manual credits
- **Admin Endpoints Added**:
  - `POST /api/admin/credit-user` - Manually credit a user
  - `GET /api/admin/user-info?email=...` - Look up user info
  - `GET /api/admin/all-users` - List all users

### December 19, 2025 - Rebranding to VidRecall
- Rebranded from "Video RAG Search" to "VidRecall"
- Updated all UI pages and API metadata

### December 19, 2025 - Email Service Fix
- Fixed password reset emails not being delivered
- Added RESEND_API_KEY to production .env

---
**Verified URL**: https://tiktoksum.staycurrentapp.com
